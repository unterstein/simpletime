@(create: Boolean, projectForm: play.api.data.Form[ProjectController.CaseProject], column: controllers.ProjectController.CaseColumn)(implicit request: play.api.mvc.Request[Any], messages: Messages)

@import logic.JsonHelper

<div class="well">
  @helper.form(routes.UserController.login, 'class -> "form-horizontal") {
    <fieldset>
      @if(projectForm.hasErrors) {
        <p class="alert alert-danger">
        @projectForm.errors.map { msg => @if(msg.key != "") {@Messages(msg.key): }@Messages(msg.message, msg.args: _*)<br/> }
        </p>
      }
      <legend>@Messages("project"): <span data-bind="text: name"> </span></legend>
      <div class="form-group">
        <label class="col-lg-2 control-label" for="name">@Messages("name")</label>
        <div class="col-lg-10">
          <input class="form-control" id="name" name="name" type="text" placeholder="@Messages("name")" data-bind="value: name">
        </div>
      </div>
      <div class="form-group">
        <table class="table table-bordered table-striped">
          <thead>
            <tr>
              <th>@Messages("column.name")</th>
              <th>@Messages("column.type")</th>
              <th></th>
            </tr>
          </thead>
          <tbody data-bind="foreach: columns">
            <tr>
              <td><input class="form-control" data-bind="value: columnName"></td>
              <td>
                <select class="form-control" data-bind="options: columnTypes, value: columnType"></select>
              </td>
              <td>
                <a href="#" class="btn btn-default deleteColumn"><i class="fa fa-trash"></i></a>
              </td>
            </tr>
          </tbody>
        </table>
        <a class="btn btn-default pull-right clearfix" id="newColumn" href="#">@Messages("column.new")</a>
      </div>
      <div class="form-group">
        <div class="col-lg-10 col-lg-offset-2">
          <button type="submit" class="btn btn-primary pull-right">@Messages(if(create) "create" else "edit")</button>
        </div>
      </div>
    </fieldset>
  }
</div>

@javaScriptInclude = {
  <script>
  $(function() {
    var model = @{Html(JsonHelper.toJson(projectForm.get))};
    var column = @{Html(JsonHelper.toJson(column))};
    var viewModel = ko.mapping.fromJS(model);

    ko.applyBindings(viewModel);

    $("#newColumn").click(function() {
      viewModel.columns.push(cloneObservable(column));
      return false;
    });

    $(document).on("click", ".deleteColumn", function () {
      var removeItem = $(".deleteColumn").index(this);
      console.log(removeItem);
      return false;
    });

    function cloneObservable(observableObject) {
      return ko.mapping.fromJS(ko.toJS(observableObject));
    }

  });
  </script>
}

@main(javaScriptInclude) {


}
